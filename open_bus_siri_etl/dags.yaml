- name: siri-etl-process-snapshot
  description: |
    Process a single snapshot and load it to DB.
    {
        "snapshot_id": "2021/07/05/12/50",
        "force_reload": true,
        "download": true
    }
  docs:
    hide: true
  tasks:
    - id: process-snapshot
      config:
        type: api
        module: open_bus_siri_etl.process_snapshot
        function: process_snapshot
        kwargs:
          snapshot_id: {}
          force_reload: {default: true}
          download: {default: true}

- name: siri-etl-process-snapshots
  description: |
    Process a range of snapshots and load them to DB.
    {
        "snapshot_id_from": "2021/07/05/12/50",
        "snapshot_id_to": "2021/07/05/12/55",
        "force_reload": false,
        "download": false,
        "only_missing": false
    }
  docs:
    hide: true
  tasks:
    - id: process-snapshots
      config:
        type: api
        module: open_bus_siri_etl.process_snapshot
        function: process_snapshots
        kwargs:
          snapshot_id_from: {}
          snapshot_id_to: {}
          force_reload: {default: false}
          download: {default: false}
          only_missing: {default: false}

- name: siri-etl-parallel-process-old-missing-snapshots
  description: |
    Parallel process old missing snapshots.
    {
        "processes": 4,
        "batch_minutes": 60,
        "from_date": "2022-03-19",
        "to_date": "2022-03-15"
    }
  docs:
    hide: true
  tasks:
    - id: parallel-process-old-missing-snapshots
      config:
        type: api
        module: open_bus_siri_etl.parallel_process_old_missing_snapshots
        function: main
        kwargs:
          processes: {}
          batch_minutes: {}
          from_date: {}
          to_date: {}

- name: siri-etl-validate-snapshots
  description: |
    Validate a range of snapshots and generate a report with validation errors.
    {
        "snapshot_id_from": "2021/07/05/12/50",
        "snapshot_id_to": "2021/07/05/12/55"
    }
  docs:
    hide: true
  tasks:
    - id: validate-snapshots
      config:
        type: api
        module: open_bus_siri_etl.validate_snapshot
        function: main
        kwargs:
          snapshot_id_from: {}
          snapshot_id_to: {}

- name: siri-etl-update-pending-snapshots
  description: |
    Check all raw snapshot files in both local and remote (S3) storage,
    snapshots which don't exist in DB siri_snapshots table are added with status pending.
  docs:
    hide: true
  tasks:
    - id: update-pending-snapshots
      config:
        type: api
        module: open_bus_siri_etl.update_pending_snapshots
        function: main
        kwargs:
          with_remote_snapshots: {default: true}
          verbose: {default: true}
